name: Release new package version

on:
  workflow_dispatch:
    inputs: 
      version-bump:
        type: choice
        description: 'How to bump a version?'
        required: true
        default: 'patch'
        options:
          - major
          - minor
          - patch
          - keep
      pages-only:
        type: boolean
        description: 'Skip release, generate only Github Pages'
        required: true
        default: false
  # push:
  #   branches: [main]
  #   paths:
  #     - '*.scala'   
  
permissions:
  id-token: write # This is required for requesting the JWT
  contents: write # This is required for actions/checkout
  packages: write
  pull-requests: write 
  pages: write    # to deploy to Pages

jobs:
  ReleasePackage:
    runs-on: ubuntu-latest
    steps:
      - id: release
        name: Create and upload new release bundles
        uses: encalmo/create-new-release-action@1d628cea9866e2ebc2d1dc1a11d945d365272b73
        with:
          tag-prefix: 'version'
          version-bump: ${{ inputs.version-bump || 'patch' }}
          release-flags: '--native'
          github-token:  ${{ secrets.GITHUB_TOKEN }}
          sonatype-token: ${{ secrets.SONATYPE_TOKEN }}
          gpg-secret-key-base64: ${{ secrets.GPG_SECRET_KEY }}
          gpg-secret-key-id: ${{ secrets.GPG_SECRET_KEY_ID }}
          pages-only: '${{ inputs.pages-only }}'
          markdown-paths: 'README.md'
          